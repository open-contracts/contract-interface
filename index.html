<h1>Open Contracts Dapp </h1>
<div>
<a href="https://github.com/open-contracts/open-contracts.github.io"> (website source code)</a>
</div>
<br />

<script charset="utf-8" src="https://cdn.jsdelivr.net/npm/@metamask/detect-provider@1.2.0/dist/detect-provider.min.js" type="text/javascript"> </script>
<script charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.4.6/ethers.umd.min.js" type="text/javascript"> </script>
<script charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" type="text/javascript"> </script>

<script charset="utf-8" src="attestation/cbor.js" type="text/javascript"></script>
<script charset="utf-8" src="attestation/cose.js" type="text/javascript"> </script>
<script charset="utf-8" src="attestation/x509.js" type="text/javascript"> </script>
<script charset="utf-8" src="attestation/base64.js" type="text/javascript"> </script>
<script charset="utf-8" src="main.js" type="text/javascript"> </script>

<p>
For now, testnet only.
Make sure you have Metamask installed and are connected to the Ropsten testnet. Also make sure you have some Ropsten Test Ether in your account to pay for Gas fees.
</p>

<div>
<form id="OpenContractForm" action="javascript:void(0);">
	<label for="network"><b>Metamask connected to: </b></label><em id="network"> awaiting connection...</em>
	<br />
	<label for="contractGithub"><b>Contract Repo:</b></label>
	<input id="contractGithub" type="text" value="open-contracts/sample-contract/main" size="60" />
	<br />
	<input type="submit" value="Load Contract" onclick="loadOpenContract()" />
</form>
</div>

<!--
<div>
<form id="ContractForm" action="javascript:void(0);">
	<label for="network"><b>Metamask connected to: </b></label><em id="network"> awaiting connection...</em>
	<br />
	<label for="contractAddress"><b>Contract Address:</b></label>
	<input id="contractAddress" type="text" value="0x8d7B945C7e0B412AAD8CBB8D301aD0f7F3f38cC3" size="60" />
	<br />
	<label for="contractABI"><b>Contract ABI:</b></label><br>
	<textarea id="contractABI"  rows="10" cols="80">
[{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"abatementCost","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"abatementShares","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"balances","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"abatement","type":"uint256"}],"name":"commit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"commitment","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"isParticipant","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"participants","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"socialCost","type":"uint256"}],"name":"participate","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"reimburse","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"government","type":"address"},{"internalType":"uint256","name":"abatementShare","type":"uint256"}],"name":"reportAbatement","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"sattelite","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"socialCosts","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"sufficientBalance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"}]
	</textarea>	
	<br />
	<input type="submit" value="Load Contract" onclick="loadContract()" />
</form>
</div>
-->
<br />
<div id="tokenActions"></div>
<br />
<div id="functionNames"></div>
<br />
<div id="currentFunction"></div>
<div id="results"></div>
<hr><hr>
<p>
You may have noticed that calling the function with open contracts functionality above did not go through. This is because it can only be called by an Enclave! 
You can connect with it below. You have to know the IP address of your enclave for now. You also have to start the EC2 script with the command:
	<br><br><code>REGISTRY_ENCLAVE_IP=18.217.233.49 PROVIDER=0xc3e9591EDB56DcC951D50CD5002108e9d8968410 python3 ec2.py</code><br><br>
Although you can change PROVIDER to any valid Ethereum address. The registry enclave with the IP 18.217.233.49 is the only one currently registered. 
This command ensures your oracle obtains a registration from it.
</p>
<form id="submitAndRunOracle" action="javascript:void(0);">
	<label for="enclaveProviderIP"><b>Enclave Provider IP:</b></label>
	<input id="enclaveProviderIP" type="text" value="127.0.0.1" size="60" />
	<script type="text/javascript">document.getElementById("enclaveProviderIP").value = new URLSearchParams(window.location.search).get("enclaveProviderIP")</script>
	<input type="submit" value="Submit" onclick="connectEnclave()">
</form>
<u>Enclave Output:</u><br>
<hr>
<div id="enclaveOutput"></div>
<hr>
<div id="xpra"></div>
